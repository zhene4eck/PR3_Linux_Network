## Задача 1. Инструмент ipcalc.

- Поднимаю виртуальную машину на Ubuntu 20.04 Server LTS.

### 1.1. Сети и маски.

- Определяем адрес сети ``192.167.38.54/13``: устанавливаем утилиту ipcalc. После чего в терминале указываем ``ipcalc 192.167.38.54/13``. Получаем адрес сети (Network) ``192.160.0.0/13``

  ![alt text](Photo/адрес-сети.png)

- Определяем перевод маски ``255.255.255.0`` в префиксную запись - ищем поле ``Netmask``, указана префиксная запись. ``= 26``.
- Определяем перевод маски ``255.255.255.0`` в двоичную запись - ищем поле ``Netmask``, в самой правой колонке указана двоичная запись. ``11111111.11111111.11111111.00000000``

  ![alt text](Photo/перевод-маски-в-префикную-и-двоичную-запись.png)
  
- Определяем перевод маски ``/15`` в обычную запись - ищем поле ``Netmask``, первая колонка до ``/15`` указывает на обычную запись маски. ``255.254.0.0``.

- Определяем перевод маски ``/15`` в двоичную запись - ищем поле ``Netmask``, последняя колонка указывает на двричную запись маски ``/15``. ``11111111.11111110.00000000.00000000``

  ![alt text](Photo/перевод-маски-в-обычную-и-двоичную-запись.png)

- Определяем перевод двоичного кода ``11111111.11111111.11111111.11110000`` в префиксную запись. Количество единиц в двоичном коде составляет префиксную маску. ``/28``

- Определяем перевод двоичного кода ``11111111.11111111.11111111.11110000`` в обычную запись по формуле ``(1*2^7+1*2^6+1*2^5+1*2^4+0 = 240)``. получим запись ``255.255.255.240`` 

- Определяем минимальный и максимальный хост в сети 12.167.38.4 с маской ``/8``. Используем ``ipcalc  12.167.38.4/8``. ``HostMin: 12.0.0.1 HostMax: 12.255.255.254``

  ![alt text](Photo/минмакс-хост-сети:8.png)

- Определяем минимальный и максимальный хост в сети ``12.167.38.4`` с маской ``1111111.11111111.00000000.00000000``. Для этого переводим из двоичной в префиксную запись и получаем ``/16``. Используем ``ipcalc  12.167.38.4/16``

    ![alt text](Photo/минмакс-хост-сети:16.png)

- Определяем минимальный и максимальный хост в сети 12.167.38.4 с маской ``255.255.254.0``. Используем ``ipcalc  12.167.38.4 255.255.254.0``. По формуле считаем сумму из числел и их позиций ``(2 в степени 7-0 означает, что нам на каждой позиции заложено определнное кол-во мест)``, которая дает 254. Это ``11111111.11111111.11111110.00000000``, в переводе в префикс это ``/13``. По аеналогии с предыдущими заданиями получаем ``HostMin: 12.160.0.1 HostMax: 12.267.255.254``

    ![alt text](Photo/минмакс-хост-сети:13.png)

- Определяем минимальный и максимальный хост в сети 12.167.38.4 с маской ``/4``. Используем ``ipcalc  12.167.38.4/8``. ``HostMin: 0.0.0.1 HostMax: 15.255.255.254``

    ![alt text](Photo/минмакс-хост-сети:4.png)

### 1.2. localhost

- Определи и запиши в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1

- Для начала необходимо обратиться к сетевым интерфесам и узнать IP localhost: ``ip addr show lo`` lo - это loopback интерфейс. Получим IP 127.0.0.1/8
- /8 - выделено 8 бит на хост, следовательно наша основная сеть 127.0.0.0. напрямую мы можем обратиться к приложению с IP 127.0.0.2, 127.1.0.1 так как они находятся в одной сети. Отсальные IP потребуют ssh-тунели (128.0.0.1 и 194.34.23.100 невозможно). Шлюз в даном случае использовать мы не можем, так как lo является виртульаным интерфейсом, трафик которого не выходит на сетевую карту (на провод) + Шлюз не видит этот трафик: Шлюз стоит на границе вашей сетевой карты. Поскольку пакеты для localhost до сетевой карты даже не доходят, шлюзу просто нечего «маршрутизировать».

### 1.3. Диапазоны и сегменты сетей

- Для определения какой IP можно использовать в качестве публичного, а какой только в качестве частного используем также ``ipcalc``. Его интерфейс укажет пометкой ``Privat Internet`` на серую сеть и другим обозначением на белую.
1. 10.0.0.45 частная Privat Internet
2. 134.43.0.2 Публичный
3. 192.168.4.2 частная Privat Internet
4. 172.20.250.4 частная Privat Internet
5. 172.0.2.1 Публичный
6. 192.172.0.1 Публичный
7. 172.68.0.2 Публичный
8. 172.16.255.255 частная Privat Internet
9. 10.10.10.10 частная Privat Internet
10. 192.169.168.1 Публичный

- Какие из перечисленных IP-адресов шлюза возможны у сети 10.10.0.0/18:
1. 10.0.0.1, нет
2. 10.10.0.2, да
3. 10.10.10.10, да
4. 10.10.100.1, нет
5. 10.10.1.255 да
- диапазон 10.10.0.1 – 10.10.63.254
- Шлюз должен гаходиться в границах нашей сети, поэтому определяем границы сети 10.10.0.0/18 (маска 255.255.192.0 указывает на 3 октет. 256-192=64 - это говорит, что новая подсеть начнется с 64, значит наша окончится на 63). Следовательно делаем вывод, что последний хост будет 10.10.63.254 (255 широковещательный), а первый 10.10.0.1 (0 запасной). Дополнительно используем ``ipcalc 10.10.0.0/18`` и ищем ``Hostmax & Hostmin`` – указывают на начало и конец диапазона, в котором расположена сеть.

## Задача 2. Статическая маршрутизация между двумя машинами

- Вывод команды ``ip addr show`` для просмотра существующих сетевых интерфейсов для ws1:
    ![alt text](Photo/ws1-ip-a.png)
- Вывод команды ``ip addr show`` для просмотра существующих сетевых интерфейсов для ws2:
    ![alt text](Photo/ws2-ip-a.png)

- Всего мы видим при выводе ``ip a`` 2 сетевых интерфеса и ни один из них не соответсвует нашей внутренней сети, из-за чего джелаем вывод, что внутрненнго сетевого интерфейса у нас нет, его нужно создать в настройках ws (добавил 2 адаптор с названием ``ws-a2``). После чего через ``ip a`` проверяем, какой именно интерфейс был добавлен (благодаря этому в настройках интерфеса мы сможем указать его название и задать ему спой IP)

- После чего в ``netplan`` через редактор создаем файл ``00-installer-config.yaml`` в котором описываем внутрненний сетевой интерфейс с нужным для нас IP и маской 192.168.100.10/160

    ![alt text](Photo/ws1-ip.png)

- Выдать для ws2 IP 172.24.116.8/12 по той же системе:

    ![alt text](Photo/ws2-ip.png)

- Файлы в /etc/netplan/ по соображениям безопасности должны иметь строго определенные права (обычно 600 или 644). Используем ``sudo chmod 600 /etc/netplan/00-installer-config.yaml`` чтобы после выполнить команду ``sudo netplan apply``. Ниже представлен вывод команды для ws-1 & ws-2:

    ![alt text](Photo/1netplan-app.png)

    ![alt text](Photo/2netplan-app.png)

- Также в момент работы можно не обратить внимание на ошибку синтаксиса. Можно провреить с помощью ``sudo netplan generate``

### 2.1 Добавление статического маршрута вручную

- Чтобы добавить статический маршрут, мы должны иметь общую сеть у виртуальных машин или мост, который имеет обую сеть. У нас ws-1 & ws-2 имеют разные сети, однако они подключены к одной сети epn0s8 - сеть одинаковая, однако это NAT - его сеть автоматически выдает DHCP. По сути это разные виртуальные роутеры, поэтому они не увидят друг друга. Следовательно нам нужно создать ``Адаптор 3`` внутренняя сеть одинаковым названием, после чего назначим временные IP c одной сети:

1. После подключения нового адаптора получаем сеть epn0s10. Для машины 1 задаем конфиг с IP из одной сети ``sudo nano /etc/netplan/01-...-...yaml`` (10.0.0.1/24), на машине 2 машине делаем также (10.0.0.2/). Теперь у нас есть сеть для обмена, фото используемой команды для машин 1 и 2 ниже:

        sudo nano /etc/netplan/01-installer-config.yaml

   ![alt text](Photo/конфиг01-машина1.png)
   ![alt text](Photo/конфиг01-машина2.png)

2. (Вначале включаем у 2 и 3 адаптора у 2х машин неразборчивый режим на "разрешить все"). 
На 1 машине прокладываем статичный маршрут к машине 2 от 1 (``ws-2 via enp0s10`` второй машины)

        sudo ip route add 172.16.0.0/12 via 10.0.0.2 dev enp0s10

    ![alt text](Photo/пинг-1-2.png)

        Важно: 172.16.0.0/12 ``16`` мы получили как: была сеть 172.24.116.8/12, у 2 октеты взяли 12-8=4 бит. Представляем маской: 11111111.11110000.00000000.00000000 - 256.240.0.0. 256-240=16. 

4. На 2 машине рокладываем статичный маршрут к машине 1 (``ws-1 via enp0s10``  первой машины) 

        sudo ip route add 192.168.0.0/16 via 10.0.0.1 dev enp0s10

    ![alt text](Photo/пинг-2-1.png)

5. Важно: мы указываем не ip для пингования машины, а только адрес сети. поэтому в коде мы указываем не 100.10, а 0.0.

### 2.2. Добавление статического маршрута с сохранением

- для этого мы открывваем файл конфигурации (ровно тот, который является связующим, тк через него будет идти маршрут) у обеих машин командой ``sudo nano /etc/netplan/01-installer-config.yaml`` и вносим необходимые изменения:

      WS-1 (192.168.100.10/16)
        routes:
          - to: 172.16.0.0/12 //канал к ws-2
            via: 10.0.0.2 //через дверь enp0s10 от ws-2
            metric: 100 //выдаем наименьший приоритет 10-100. Значение 100 даёт статическому маршруту более низкий приоритет, чем основному gateway4 (обычно metric ~10-50 от DHCP). Это предотвращает конфликты: трафик к локальным сетям идёт по статическому маршруту, остальное — по умолчанию.

    ![alt text](Photo/ws1-статический-сохр.png)

      WS-2 (172.24.116.8/12)
        routes:
          - to: 92.168.0.0/16 //канал к ws-1
            via: 10.0.0.1 //через дверь enp0s10 от ws-1

    ![alt text](Photo/ws2-статический-сохр.png)

- После выдаем права для применения каждой конфигурации ``chmod 600``, после чего выполняем команду ``sudo netplan apply``

    ![alt text](Photo/ws1-статический-сохр-apply.png)

    ![alt text](Photo/ws2-статический-сохр-apply.png)

      Важно! Мы все также в записи конфига используем именно адреса сети, а не IP

- Пингую соединение с машинами:

      ws1 ``ping -c 4 172.24.116.8`` -с 4 это про 4 строки вывода

    ![alt text](Photo/пинг-1.png)

      ws1 ``ping -c 4 192.168.100.10``

    ![alt text](Photo/пинг-2.png)
  

## Задача 3. Утилита iperf3.

- Устанавливаем утилиту: ``sudo apt install iperf3``

      iperf3 показывает результат скорости передачи информации IP в выбранной единице (-f), но не конвертирует автоматически.

### 3.1. Скорость соединения.

      1 байт = 8 бит

      Mbps → MB/s: делите на 8 (Mbps ÷ 8 = MB/s)

      MB/s → Mbps: умножайте на 8 (MB/s × 8 = Mbps)

      Другие: Kbps = 1000 bps, Mbps = 1000 Kbps, Gbps = 1000 Mbps.
    
- 8 Mbps = 1 MB/s
- 100 MB/s = 800 Mbps =800 000 Kbps
- 1 Gbps = 1000 Mbps

### 3.2. Утилита iperf3.

- На WS1 усанавливаем ожидание подключения ``iperf3 -s -p 5202`` -p 5202 так как 5201 уже занят.

    ![alt text](Photo/прием1.png)


- На WS2 запускаем ``iperf3 -c 192.168.100.10``

      -R — (reverse) изменить направление: клиент принимаетсервер отправляет.
      -t <секунды> — задать время теста (по умолчанию 10).
      -P <число> — запустить несколько параллельных потоков (например-P 4) для более точного измерения на высоких скоростях.
      -u — использовать протокол UDP (по умолчанию TCP)
      -c - сервер
      -s - клиент

    ![alt text](Photo/прием2.png)

## Задача 4. Сетевой экран. 
